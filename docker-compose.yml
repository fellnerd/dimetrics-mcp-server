services:
  # Dimetrics MCP Server (Original)
  dimetrics-mcp-server:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: dimetrics-mcp-server
    ports:
      - "5201:8000"
    environment:
      - DIMETRICS_API_URL=${DIMETRICS_API_URL:-https://dimetrics.api.nc.released.services/api}
      - DIMETRICS_API_KEY=${DIMETRICS_API_KEY}
      - DEBUG=${DEBUG:-false}
      - PORT=8000
      - HOST=0.0.0.0
      - MCP_TRANSPORT=http
    env_file:
      - .env
    volumes:
      - ./logs:/app/logs
    restart: unless-stopped
    networks:
      - dimetrics-n8n-net

  # Werkportal MCP Server (Neu)
  werkportal-mcp-server:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: werkportal-mcp-server
    ports:
      - "5202:8000"
    environment:
      - DIMETRICS_API_URL=https://werkportal.api.nc.released.services/api
      - DIMETRICS_API_KEY=23453245
      - DEBUG=true
      - PORT=8000
      - HOST=0.0.0.0
      - MCP_TRANSPORT=http
    volumes:
      - ./logs/werkportal:/app/logs
    restart: unless-stopped
    networks:
      - dimetrics-n8n-net

  # PPMC MCP Server (Neu)
  ppmc-mcp-server:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: ppmc-mcp-server
    ports:
      - "5203:8000"
    environment:
      - DIMETRICS_API_URL=https://ppmc.api.nc.released.services/api
      - DIMETRICS_API_KEY=f87d66baf43f7868cafb5cb5e5ebfac768dee600
      - DEBUG=true
      - PORT=8000
      - HOST=0.0.0.0
      - MCP_TRANSPORT=http
    volumes:
      - ./logs/ppmc:/app/logs
    restart: unless-stopped
    networks:
      - dimetrics-n8n-net

  # Optional: Nginx reverse proxy for SSL termination
  nginx:
    image: nginx:alpine
    container_name: dimetrics-nginx
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./nginx/ssl:/etc/nginx/ssl:ro
      - ./logs/nginx:/var/log/nginx
    depends_on:
      - dimetrics-mcp-server
    restart: unless-stopped
    networks:
      - dimetrics-n8n-net
    profiles:
      - nginx

networks:
  dimetrics-n8n-net:
    external: true

volumes:
  logs:
    driver: local
